---
title: Identidade e autenticação de serviço
description: Saiba mais sobre a identidade do ponto de extremidade de um serviço, um valor gerado a partir do WSDL do serviço, que o WCF usa para autenticar o serviço.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- authentication [WCF], specifying the identity of a service
ms.assetid: a4c8f52c-5b30-45c4-a545-63244aba82be
ms.openlocfilehash: ae217b4a2c3432321c7ef2e663922a87b82acbea
ms.sourcegitcommit: 358a28048f36a8dca39a9fe6e6ac1f1913acadd5
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 06/23/2020
ms.locfileid: "85246565"
---
# <a name="service-identity-and-authentication"></a><span data-ttu-id="15c3f-103">Identidade e autenticação de serviço</span><span class="sxs-lookup"><span data-stu-id="15c3f-103">Service Identity and Authentication</span></span>
<span data-ttu-id="15c3f-104">A identidade do *ponto de extremidade* de um serviço é um valor gerado a partir do serviço WSDL (Web Services Description Language).</span><span class="sxs-lookup"><span data-stu-id="15c3f-104">A service's *endpoint identity* is a value generated from the service Web Services Description Language (WSDL).</span></span> <span data-ttu-id="15c3f-105">Esse valor, propagado para qualquer cliente, é usado para autenticar o serviço.</span><span class="sxs-lookup"><span data-stu-id="15c3f-105">This value, propagated to any client, is used to authenticate the service.</span></span> <span data-ttu-id="15c3f-106">Depois que o cliente inicia uma comunicação com um ponto de extremidade e o serviço se autentica para o cliente, o cliente compara o valor de identidade do ponto de extremidade com o valor real que o processo de autenticação do ponto de extremidade retornou.</span><span class="sxs-lookup"><span data-stu-id="15c3f-106">After the client initiates a communication to an endpoint and the service authenticates itself to the client, the client compares the endpoint identity value with the actual value the endpoint authentication process returned.</span></span> <span data-ttu-id="15c3f-107">Se eles corresponderem, o cliente terá a garantia de que ele contatou o ponto de extremidade de serviço esperado.</span><span class="sxs-lookup"><span data-stu-id="15c3f-107">If they match, the client is assured it has contacted the expected service endpoint.</span></span> <span data-ttu-id="15c3f-108">Isso funciona como uma proteção contra *phishing* , impedindo que um cliente seja redirecionado para um ponto de extremidade hospedado por um serviço mal-intencionado.</span><span class="sxs-lookup"><span data-stu-id="15c3f-108">This functions as a protection against *phishing* by preventing a client from being redirected to an endpoint hosted by a malicious service.</span></span>  
  
 <span data-ttu-id="15c3f-109">Para obter um aplicativo de exemplo que demonstre a configuração de identidade, consulte [exemplo de identidade de serviço](../samples/service-identity-sample.md).</span><span class="sxs-lookup"><span data-stu-id="15c3f-109">For a sample application that demonstrates identity setting, see [Service Identity Sample](../samples/service-identity-sample.md).</span></span> <span data-ttu-id="15c3f-110">Para obter mais informações sobre pontos de extremidade e endereços de ponto de extremidades, consulte [endereços](endpoint-addresses.md).</span><span class="sxs-lookup"><span data-stu-id="15c3f-110">For more information about endpoints and endpoint addresses, see [Addresses](endpoint-addresses.md).</span></span>  
  
> [!NOTE]
> <span data-ttu-id="15c3f-111">Quando você usa NT LanMan (NTLM) para autenticação, a identidade do serviço não é verificada porque, em NTLM, o cliente não consegue autenticar o servidor.</span><span class="sxs-lookup"><span data-stu-id="15c3f-111">When you use NT LanMan (NTLM) for authentication, the service identity is not checked because, under NTLM, the client is unable to authenticate the server.</span></span> <span data-ttu-id="15c3f-112">O NTLM é usado quando os computadores fazem parte de um grupo de trabalho do Windows ou ao executar uma versão mais antiga do Windows que não oferece suporte à autenticação Kerberos.</span><span class="sxs-lookup"><span data-stu-id="15c3f-112">NTLM is used when computers are part of a Windows workgroup, or when running an older version of Windows that does not support Kerberos authentication.</span></span>  
  
 <span data-ttu-id="15c3f-113">Quando o cliente inicia um canal seguro para enviar uma mensagem a um serviço por ele, a infraestrutura Windows Communication Foundation (WCF) autentica o serviço e só envia a mensagem se a identidade do serviço corresponder à identidade especificada no endereço do ponto de extremidade que o cliente usa.</span><span class="sxs-lookup"><span data-stu-id="15c3f-113">When the client initiates a secure channel to send a message to a service over it, the Windows Communication Foundation (WCF) infrastructure authenticates the service, and only sends the message if the service identity matches the identity specified in the endpoint address the client uses.</span></span>  
  
 <span data-ttu-id="15c3f-114">O processamento de identidade consiste nos seguintes estágios:</span><span class="sxs-lookup"><span data-stu-id="15c3f-114">Identity processing consists of the following stages:</span></span>  
  
- <span data-ttu-id="15c3f-115">No momento do design, o desenvolvedor do cliente determina a identidade do serviço dos metadados do ponto de extremidade (expostos por meio do WSDL).</span><span class="sxs-lookup"><span data-stu-id="15c3f-115">At design time, the client developer determines the service's identity from the endpoint's metadata (exposed through WSDL).</span></span>  
  
- <span data-ttu-id="15c3f-116">Em tempo de execução, o aplicativo cliente verifica as declarações das credenciais de segurança do serviço antes de enviar qualquer mensagem para o serviço.</span><span class="sxs-lookup"><span data-stu-id="15c3f-116">At runtime, the client application checks the claims of the service's security credentials before sending any messages to the service.</span></span>  
  
 <span data-ttu-id="15c3f-117">O processamento de identidades no cliente é análogo à autenticação de cliente no serviço.</span><span class="sxs-lookup"><span data-stu-id="15c3f-117">Identity processing on the client is analogous to client authentication on the service.</span></span> <span data-ttu-id="15c3f-118">Um serviço seguro não executa código até que as credenciais do cliente tenham sido autenticadas.</span><span class="sxs-lookup"><span data-stu-id="15c3f-118">A secure service does not execute code until the client's credentials have been authenticated.</span></span> <span data-ttu-id="15c3f-119">Da mesma forma, o cliente não envia mensagens para o serviço até que as credenciais do serviço tenham sido autenticadas com base no que é conhecido com antecedência dos metadados do serviço.</span><span class="sxs-lookup"><span data-stu-id="15c3f-119">Likewise, the client does not send messages to the service until the service's credentials have been authenticated based on what is known in advance from the service's metadata.</span></span>  
  
 <span data-ttu-id="15c3f-120">A <xref:System.ServiceModel.EndpointAddress.Identity%2A> propriedade da <xref:System.ServiceModel.EndpointAddress> classe representa a identidade do serviço chamado pelo cliente.</span><span class="sxs-lookup"><span data-stu-id="15c3f-120">The <xref:System.ServiceModel.EndpointAddress.Identity%2A> property of the <xref:System.ServiceModel.EndpointAddress> class represents the identity of the service called by the client.</span></span> <span data-ttu-id="15c3f-121">O serviço publica o <xref:System.ServiceModel.EndpointAddress.Identity%2A> em seus metadados.</span><span class="sxs-lookup"><span data-stu-id="15c3f-121">The service publishes the <xref:System.ServiceModel.EndpointAddress.Identity%2A> in its metadata.</span></span> <span data-ttu-id="15c3f-122">Quando o desenvolvedor cliente executa a [ferramenta de utilitário de metadados ServiceModel (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md) em relação ao ponto de extremidade de serviço, a configuração gerada contém o valor da Propriedade do serviço <xref:System.ServiceModel.EndpointAddress.Identity%2A> .</span><span class="sxs-lookup"><span data-stu-id="15c3f-122">When the client developer runs the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md) against the service endpoint, the generated configuration contains the value of the service's <xref:System.ServiceModel.EndpointAddress.Identity%2A> property.</span></span> <span data-ttu-id="15c3f-123">A infraestrutura do WCF (se configurada com segurança) verifica se o serviço possui a identidade especificada.</span><span class="sxs-lookup"><span data-stu-id="15c3f-123">The WCF infrastructure (if configured with security) verifies that the service possesses the identity specified.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="15c3f-124">Os metadados contêm a identidade esperada do serviço, portanto, é recomendável que você exponha os metadados do serviço por meio de meios seguros, por exemplo, criando um ponto de extremidade HTTPS para o serviço.</span><span class="sxs-lookup"><span data-stu-id="15c3f-124">The metadata contains the expected identity of the service, so it is recommended that you expose the service metadata through secure means, for example, by creating an HTTPS endpoint for the service.</span></span> <span data-ttu-id="15c3f-125">Para obter mais informações, consulte [como: proteger pontos de extremidade de metadados](how-to-secure-metadata-endpoints.md).</span><span class="sxs-lookup"><span data-stu-id="15c3f-125">For more information, see [How to: Secure Metadata Endpoints](how-to-secure-metadata-endpoints.md).</span></span>  
  
## <a name="identity-types"></a><span data-ttu-id="15c3f-126">Tipos de identidade</span><span class="sxs-lookup"><span data-stu-id="15c3f-126">Identity Types</span></span>  
 <span data-ttu-id="15c3f-127">Um serviço pode fornecer seis tipos de identidades.</span><span class="sxs-lookup"><span data-stu-id="15c3f-127">A service can provide six types of identities.</span></span> <span data-ttu-id="15c3f-128">Cada tipo de identidade corresponde a um elemento que pode estar contido dentro do `<identity>` elemento na configuração.</span><span class="sxs-lookup"><span data-stu-id="15c3f-128">Each identity type corresponds to an element that can be contained inside the `<identity>` element in configuration.</span></span> <span data-ttu-id="15c3f-129">O tipo usado depende do cenário e dos requisitos de segurança do serviço.</span><span class="sxs-lookup"><span data-stu-id="15c3f-129">The type used depends on the scenario and the service's security requirements.</span></span> <span data-ttu-id="15c3f-130">A tabela a seguir descreve cada tipo de identidade.</span><span class="sxs-lookup"><span data-stu-id="15c3f-130">The following table describes each identity type.</span></span>  
  
|<span data-ttu-id="15c3f-131">Tipo de identidade</span><span class="sxs-lookup"><span data-stu-id="15c3f-131">Identity type</span></span>|<span data-ttu-id="15c3f-132">Description</span><span class="sxs-lookup"><span data-stu-id="15c3f-132">Description</span></span>|<span data-ttu-id="15c3f-133">Cenário típico</span><span class="sxs-lookup"><span data-stu-id="15c3f-133">Typical scenario</span></span>|  
|-------------------|-----------------|----------------------|  
|<span data-ttu-id="15c3f-134">Sistema de nome de domínio (DNS)</span><span class="sxs-lookup"><span data-stu-id="15c3f-134">Domain Name System (DNS)</span></span>|<span data-ttu-id="15c3f-135">Use esse elemento com certificados X. 509 ou contas do Windows.</span><span class="sxs-lookup"><span data-stu-id="15c3f-135">Use this element with X.509 certificates or Windows accounts.</span></span> <span data-ttu-id="15c3f-136">Ele compara o nome DNS especificado na credencial com o valor especificado neste elemento.</span><span class="sxs-lookup"><span data-stu-id="15c3f-136">It compares the DNS name specified in the credential with the value specified in this element.</span></span>|<span data-ttu-id="15c3f-137">Uma verificação de DNS permite que você use certificados com nomes DNS ou de entidade.</span><span class="sxs-lookup"><span data-stu-id="15c3f-137">A DNS check enables you to use certificates with DNS or subject names.</span></span> <span data-ttu-id="15c3f-138">Se um certificado for reemitido com o mesmo nome DNS ou da entidade, a verificação de identidade ainda será válida.</span><span class="sxs-lookup"><span data-stu-id="15c3f-138">If a certificate is reissued with the same DNS or subject name, then the identity check is still valid.</span></span> <span data-ttu-id="15c3f-139">Quando um certificado é reemitido, ele obtém uma nova chave RSA, mas retém o mesmo nome DNS ou assunto.</span><span class="sxs-lookup"><span data-stu-id="15c3f-139">When a certificate is reissued, it gets a new RSA key but retains the same DNS or subject name.</span></span> <span data-ttu-id="15c3f-140">Isso significa que os clientes não precisam atualizar suas informações de identidade sobre o serviço.</span><span class="sxs-lookup"><span data-stu-id="15c3f-140">This means that clients do not have to update their identity information about the service.</span></span>|  
|<span data-ttu-id="15c3f-141">Certificado.</span><span class="sxs-lookup"><span data-stu-id="15c3f-141">Certificate.</span></span> <span data-ttu-id="15c3f-142">O padrão quando `ClientCredentialType` é definido como certificado.</span><span class="sxs-lookup"><span data-stu-id="15c3f-142">The default when `ClientCredentialType` is set to Certificate.</span></span>|<span data-ttu-id="15c3f-143">Esse elemento especifica um valor de certificado X. 509 codificado na base64 para comparar com o cliente.</span><span class="sxs-lookup"><span data-stu-id="15c3f-143">This element specifies a Base64-encoded X.509 certificate value to compare with the client.</span></span><br /><br /> <span data-ttu-id="15c3f-144">Use também esse elemento ao usar um CardSpace como uma credencial para autenticar o serviço.</span><span class="sxs-lookup"><span data-stu-id="15c3f-144">Also use this element when using a CardSpace as a credential to authenticate the service.</span></span>|<span data-ttu-id="15c3f-145">Esse elemento restringe a autenticação a um único certificado com base no seu valor de impressão digital.</span><span class="sxs-lookup"><span data-stu-id="15c3f-145">This element restricts authentication to a single certificate based upon its thumbprint value.</span></span> <span data-ttu-id="15c3f-146">Isso habilita a autenticação mais estrita porque os valores de impressão digital são exclusivos.</span><span class="sxs-lookup"><span data-stu-id="15c3f-146">This enables stricter authentication because thumbprint values are unique.</span></span> <span data-ttu-id="15c3f-147">Isso é fornecido com uma limitação: se o certificado for reemitido com o mesmo nome de assunto, ele também terá uma nova impressão digital.</span><span class="sxs-lookup"><span data-stu-id="15c3f-147">This comes with one caveat: If the certificate is reissued with the same Subject name, it also has a new Thumbprint.</span></span> <span data-ttu-id="15c3f-148">Portanto, os clientes não podem validar o serviço, a menos que a nova impressão digital seja conhecida.</span><span class="sxs-lookup"><span data-stu-id="15c3f-148">Therefore, clients are not able to validate the service unless the new thumbprint is known.</span></span> <span data-ttu-id="15c3f-149">Para obter mais informações sobre como localizar a impressão digital de um certificado, consulte [como recuperar a impressão digital de um certificado](how-to-retrieve-the-thumbprint-of-a-certificate.md).</span><span class="sxs-lookup"><span data-stu-id="15c3f-149">For more information about finding a certificate's thumbprint, see [How to: Retrieve the Thumbprint of a Certificate](how-to-retrieve-the-thumbprint-of-a-certificate.md).</span></span>|  
|<span data-ttu-id="15c3f-150">Referência do certificado</span><span class="sxs-lookup"><span data-stu-id="15c3f-150">Certificate Reference</span></span>|<span data-ttu-id="15c3f-151">Idêntico à opção de certificado descrita anteriormente.</span><span class="sxs-lookup"><span data-stu-id="15c3f-151">Identical to the Certificate option described previously.</span></span> <span data-ttu-id="15c3f-152">No entanto, esse elemento permite que você especifique um nome de certificado e o local de armazenamento do qual recuperar o certificado.</span><span class="sxs-lookup"><span data-stu-id="15c3f-152">However, this element enables you to specify a certificate name and store location from which to retrieve the certificate.</span></span>|<span data-ttu-id="15c3f-153">O mesmo que o cenário de certificado descrito anteriormente.</span><span class="sxs-lookup"><span data-stu-id="15c3f-153">Same as the Certificate scenario described previously.</span></span><br /><br /> <span data-ttu-id="15c3f-154">O benefício é que o local do repositório de certificados pode ser alterado.</span><span class="sxs-lookup"><span data-stu-id="15c3f-154">The benefit is that the certificate store location can change.</span></span>|  
|<span data-ttu-id="15c3f-155">RSA</span><span class="sxs-lookup"><span data-stu-id="15c3f-155">RSA</span></span>|<span data-ttu-id="15c3f-156">Esse elemento especifica um valor de chave RSA para comparar com o cliente.</span><span class="sxs-lookup"><span data-stu-id="15c3f-156">This element specifies an RSA key value to compare with the client.</span></span> <span data-ttu-id="15c3f-157">Isso é semelhante à opção de certificado, mas em vez de usar a impressão digital do certificado, a chave RSA do certificado é usada em vez disso.</span><span class="sxs-lookup"><span data-stu-id="15c3f-157">This is similar to the certificate option but rather than using the certificate's thumbprint, the certificate's RSA key is used instead.</span></span>|<span data-ttu-id="15c3f-158">Uma verificação RSA permite restringir especificamente a autenticação a um único certificado com base em sua chave RSA.</span><span class="sxs-lookup"><span data-stu-id="15c3f-158">An RSA check enables you to specifically restrict authentication to a single certificate based upon its RSA key.</span></span> <span data-ttu-id="15c3f-159">Isso permite uma autenticação mais estrita de uma chave RSA específica às custas do serviço, o que não funciona mais com os clientes existentes se o valor da chave RSA for alterado.</span><span class="sxs-lookup"><span data-stu-id="15c3f-159">This enables stricter authentication of a specific RSA key at the expense of the service, which no longer works with existing clients if the RSA key value changes.</span></span>|  
|<span data-ttu-id="15c3f-160">Nome UPN.</span><span class="sxs-lookup"><span data-stu-id="15c3f-160">User principal name (UPN).</span></span> <span data-ttu-id="15c3f-161">O padrão quando o `ClientCredentialType` é definido como Windows e o processo de serviço não está em execução em uma das contas do sistema.</span><span class="sxs-lookup"><span data-stu-id="15c3f-161">The default when the `ClientCredentialType` is set to Windows and the service process is not running under one of the system accounts.</span></span>|<span data-ttu-id="15c3f-162">Esse elemento Especifica o UPN sob o qual o serviço está sendo executado.</span><span class="sxs-lookup"><span data-stu-id="15c3f-162">This element specifies the UPN that the service is running under.</span></span> <span data-ttu-id="15c3f-163">Consulte a seção protocolo e identidade Kerberos de [substituindo a identidade de um serviço para autenticação](../extending/overriding-the-identity-of-a-service-for-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="15c3f-163">See the Kerberos Protocol and Identity section of [Overriding the Identity of a Service for Authentication](../extending/overriding-the-identity-of-a-service-for-authentication.md).</span></span>|<span data-ttu-id="15c3f-164">Isso garante que o serviço esteja sendo executado em uma conta de usuário do Windows específica.</span><span class="sxs-lookup"><span data-stu-id="15c3f-164">This ensures that the service is running under a specific Windows user account.</span></span> <span data-ttu-id="15c3f-165">A conta de usuário pode ser o usuário conectado no momento ou o serviço em execução em uma conta de usuário específica.</span><span class="sxs-lookup"><span data-stu-id="15c3f-165">The user account can be either the current logged-on user or the service running under a particular user account.</span></span><br /><br /> <span data-ttu-id="15c3f-166">Essa configuração aproveita a segurança Kerberos do Windows se o serviço estiver sendo executado em uma conta de domínio dentro de um ambiente de Active Directory.</span><span class="sxs-lookup"><span data-stu-id="15c3f-166">This setting takes advantage of Windows Kerberos security if the service is running under a domain account within an Active Directory environment.</span></span>|  
|<span data-ttu-id="15c3f-167">SPN (nome da entidade de serviço).</span><span class="sxs-lookup"><span data-stu-id="15c3f-167">Service principal name (SPN).</span></span> <span data-ttu-id="15c3f-168">O padrão quando o `ClientCredentialType` é definido como Windows e o processo de serviço está em execução em uma das contas de sistema – LocalService, LocalSystem ou NetworkService.</span><span class="sxs-lookup"><span data-stu-id="15c3f-168">The default when the `ClientCredentialType` is set to Windows and the service process is running under one of the system accounts—LocalService, LocalSystem, or NetworkService.</span></span>|<span data-ttu-id="15c3f-169">Esse elemento Especifica o SPN associado à conta do serviço.</span><span class="sxs-lookup"><span data-stu-id="15c3f-169">This element specifies the SPN associated with the service's account.</span></span> <span data-ttu-id="15c3f-170">Consulte a seção protocolo e identidade Kerberos de [substituindo a identidade de um serviço para autenticação](../extending/overriding-the-identity-of-a-service-for-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="15c3f-170">See the Kerberos Protocol and Identity section of [Overriding the Identity of a Service for Authentication](../extending/overriding-the-identity-of-a-service-for-authentication.md).</span></span>|<span data-ttu-id="15c3f-171">Isso garante que o SPN e a conta específica do Windows associada ao SPN identifiquem o serviço.</span><span class="sxs-lookup"><span data-stu-id="15c3f-171">This ensures that the SPN and the specific Windows account associated with the SPN identify the service.</span></span><br /><br /> <span data-ttu-id="15c3f-172">Você pode usar a ferramenta Setspn.exe para associar uma conta de computador à conta de usuário do serviço.</span><span class="sxs-lookup"><span data-stu-id="15c3f-172">You can use the Setspn.exe tool to associate a machine account for the service's user account.</span></span><br /><br /> <span data-ttu-id="15c3f-173">Essa configuração aproveita a segurança Kerberos do Windows se o serviço estiver em execução em uma das contas do sistema ou em uma conta de domínio que tenha um nome SPN associado e o computador seja membro de um domínio em um ambiente de Active Directory.</span><span class="sxs-lookup"><span data-stu-id="15c3f-173">This setting takes advantage of Windows Kerberos security if the service is running under one of the system accounts or under a domain account that has an associated SPN name with it and the computer is a member of a domain within an Active Directory environment.</span></span>|  
  
## <a name="specifying-identity-at-the-service"></a><span data-ttu-id="15c3f-174">Especificando a identidade no serviço</span><span class="sxs-lookup"><span data-stu-id="15c3f-174">Specifying Identity at the Service</span></span>  
 <span data-ttu-id="15c3f-175">Normalmente, você não precisa definir a identidade em um serviço porque a seleção de um tipo de credencial de cliente determina o tipo de identidade exposto nos metadados do serviço.</span><span class="sxs-lookup"><span data-stu-id="15c3f-175">Typically, you do not have to set the identity on a service because the selection of a client credential type dictates the type of identity exposed in the service metadata.</span></span> <span data-ttu-id="15c3f-176">Para obter mais informações sobre como substituir ou especificar a identidade do serviço, consulte [substituindo a identidade de um serviço para autenticação](../extending/overriding-the-identity-of-a-service-for-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="15c3f-176">For more information about how to override or specify service identity, see [Overriding the Identity of a Service for Authentication](../extending/overriding-the-identity-of-a-service-for-authentication.md).</span></span>  
  
## <a name="using-the-identity-element-in-configuration"></a><span data-ttu-id="15c3f-177">Usando o \<identity> elemento na configuração</span><span class="sxs-lookup"><span data-stu-id="15c3f-177">Using the \<identity> Element in Configuration</span></span>  
 <span data-ttu-id="15c3f-178">Se você alterar o tipo de credencial do cliente na associação anteriormente mostrada para `Certificate,` , o WSDL gerado conterá um certificado X. 509 serializado na base64 para o valor de identidade, conforme mostrado no código a seguir.</span><span class="sxs-lookup"><span data-stu-id="15c3f-178">If you change the client credential type in the binding previously shown to `Certificate,` then the generated WSDL contains a Base64 serialized X.509 certificate for the identity value as shown in the following code.</span></span> <span data-ttu-id="15c3f-179">Esse é o padrão para todos os tipos de credencial do cliente que não sejam o Windows.</span><span class="sxs-lookup"><span data-stu-id="15c3f-179">This is the default for all client credential types other than Windows.</span></span>  

 <span data-ttu-id="15c3f-180">Você pode alterar o valor da identidade do serviço padrão ou alterar o tipo da identidade usando o `<identity>` elemento na configuração ou definindo a identidade no código.</span><span class="sxs-lookup"><span data-stu-id="15c3f-180">You can change the value of the default service identity or change the type of the identity by using the `<identity>` element in configuration or by setting the identity in code.</span></span> <span data-ttu-id="15c3f-181">O código de configuração a seguir define uma identidade de DNS (sistema de nomes de domínio) com o valor `contoso.com` .</span><span class="sxs-lookup"><span data-stu-id="15c3f-181">The following configuration code sets a domain name system (DNS) identity with the value `contoso.com`.</span></span>  

## <a name="setting-identity-programmatically"></a><span data-ttu-id="15c3f-182">Definindo a identidade programaticamente</span><span class="sxs-lookup"><span data-stu-id="15c3f-182">Setting Identity Programmatically</span></span>  
 <span data-ttu-id="15c3f-183">O serviço não precisa especificar uma identidade explicitamente, pois o WCF a determina automaticamente.</span><span class="sxs-lookup"><span data-stu-id="15c3f-183">Your service does not have to explicitly specify an identity, because WCF automatically determines it.</span></span> <span data-ttu-id="15c3f-184">No entanto, o WCF permite que você especifique uma identidade em um ponto de extremidade, se necessário.</span><span class="sxs-lookup"><span data-stu-id="15c3f-184">However, WCF allows you to specify an identity on an endpoint, if required.</span></span> <span data-ttu-id="15c3f-185">O código a seguir adiciona um novo ponto de extremidade de serviço com uma identidade DNS específica.</span><span class="sxs-lookup"><span data-stu-id="15c3f-185">The following code adds a new service endpoint with a specific DNS identity.</span></span>  
  
 [!code-csharp[C_Identity#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#5)]
 [!code-vb[C_Identity#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#5)]  
  
## <a name="specifying-identity-at-the-client"></a><span data-ttu-id="15c3f-186">Especificando a identidade no cliente</span><span class="sxs-lookup"><span data-stu-id="15c3f-186">Specifying Identity at the Client</span></span>  
 <span data-ttu-id="15c3f-187">Em tempo de design, um desenvolvedor cliente normalmente usa a [ferramenta de utilitário de metadados ServiceModel (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md) para gerar a configuração do cliente.</span><span class="sxs-lookup"><span data-stu-id="15c3f-187">At design time, a client developer typically uses the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md) to generate client configuration.</span></span> <span data-ttu-id="15c3f-188">O arquivo de configuração gerado (destinado ao uso pelo cliente) contém a identidade do servidor.</span><span class="sxs-lookup"><span data-stu-id="15c3f-188">The generated configuration file (intended for use by the client) contains the server's identity.</span></span> <span data-ttu-id="15c3f-189">Por exemplo, o código a seguir é gerado de um serviço que especifica uma identidade DNS, conforme mostrado no exemplo anterior.</span><span class="sxs-lookup"><span data-stu-id="15c3f-189">For example, the following code is generated from a service that specifies a DNS identity, as shown in the preceding example.</span></span> <span data-ttu-id="15c3f-190">Observe que o valor de identidade do ponto de extremidade do cliente corresponde ao do serviço.</span><span class="sxs-lookup"><span data-stu-id="15c3f-190">Note that the client's endpoint identity value matches that of the service.</span></span> <span data-ttu-id="15c3f-191">Nesse caso, quando o cliente recebe as credenciais do Windows (Kerberos) para o serviço, ele espera que o valor seja `contoso.com` .</span><span class="sxs-lookup"><span data-stu-id="15c3f-191">In this case, when the client receives the Windows (Kerberos) credentials for the service, it expects the value to be `contoso.com`.</span></span>  

 <span data-ttu-id="15c3f-192">Se, em vez do Windows, o serviço especificar um certificado como o tipo de credencial do cliente, espera-se que a propriedade DNS do certificado seja o valor `contoso.com` .</span><span class="sxs-lookup"><span data-stu-id="15c3f-192">If, instead of Windows, the service specifies a certificate as the client credential type, then the certificate's DNS property is expected to be the value `contoso.com`.</span></span> <span data-ttu-id="15c3f-193">(Ou se a propriedade DNS for `null` , o nome da entidade do certificado deverá ser `contoso.com` .)</span><span class="sxs-lookup"><span data-stu-id="15c3f-193">(Or if the DNS property is `null`, the certificate's subject name must be `contoso.com`.)</span></span>  
  
#### <a name="using-a-specific-value-for-identity"></a><span data-ttu-id="15c3f-194">Usando um valor específico para identidade</span><span class="sxs-lookup"><span data-stu-id="15c3f-194">Using a Specific Value for Identity</span></span>  
 <span data-ttu-id="15c3f-195">O arquivo de configuração do cliente a seguir mostra como espera-se que a identidade do serviço seja um valor específico.</span><span class="sxs-lookup"><span data-stu-id="15c3f-195">The following client configuration file shows how the service's identity is expected to be a specific value.</span></span> <span data-ttu-id="15c3f-196">No exemplo a seguir, o cliente pode se comunicar com dois pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="15c3f-196">In the following example, the client can communicate with two endpoints.</span></span> <span data-ttu-id="15c3f-197">O primeiro é identificado com uma impressão digital do certificado e o segundo com uma chave RSA de certificado.</span><span class="sxs-lookup"><span data-stu-id="15c3f-197">The first is identified with a certificate thumbprint and the second with a certificate RSA key.</span></span> <span data-ttu-id="15c3f-198">Ou seja, um certificado que contém apenas um par chave pública/chave privada, mas não é emitido por uma autoridade confiável.</span><span class="sxs-lookup"><span data-stu-id="15c3f-198">That is, a certificate that contains only a public key/private key pair, but is not issued by a trusted authority.</span></span>  

## <a name="identity-checking-at-run-time"></a><span data-ttu-id="15c3f-199">Verificação de identidade em tempo de execução</span><span class="sxs-lookup"><span data-stu-id="15c3f-199">Identity Checking at Run Time</span></span>  
 <span data-ttu-id="15c3f-200">Em tempo de design, um desenvolvedor cliente determina a identidade do servidor por meio de seus metadados.</span><span class="sxs-lookup"><span data-stu-id="15c3f-200">At design time, a client developer determines the server's identity through its metadata.</span></span> <span data-ttu-id="15c3f-201">Em tempo de execução, a verificação de identidade é executada antes de chamar qualquer ponto de extremidade no serviço.</span><span class="sxs-lookup"><span data-stu-id="15c3f-201">At runtime, the identity check is performed before calling any endpoints on the service.</span></span>  
  
 <span data-ttu-id="15c3f-202">O valor de identidade está vinculado ao tipo de autenticação especificado pelos metadados; em outras palavras, o tipo de credenciais usado para o serviço.</span><span class="sxs-lookup"><span data-stu-id="15c3f-202">The identity value is tied to the type of authentication specified by metadata; in other words, the type of credentials used for the service.</span></span>  
  
 <span data-ttu-id="15c3f-203">Se o canal estiver configurado para autenticar usando protocolo SSL de nível de mensagem ou de transporte (SSL) com certificados X. 509 para autenticação, os seguintes valores de identidade serão válidos:</span><span class="sxs-lookup"><span data-stu-id="15c3f-203">If the channel is configured to authenticate using message- or transport-level Secure Sockets Layer (SSL) with X.509 certificates for authentication, the following identity values are valid:</span></span>  
  
- <span data-ttu-id="15c3f-204">DNS.</span><span class="sxs-lookup"><span data-stu-id="15c3f-204">DNS.</span></span> <span data-ttu-id="15c3f-205">O WCF garante que o certificado fornecido durante o handshake SSL contenha um atributo DNS ou `CommonName` (CN) igual ao valor especificado na identidade DNS no cliente.</span><span class="sxs-lookup"><span data-stu-id="15c3f-205">WCF ensures that the certificate provided during the SSL handshake contains a DNS or `CommonName` (CN) attribute equal to the value specified in the DNS identity on the client.</span></span> <span data-ttu-id="15c3f-206">Observe que essas verificações são feitas além da determinação da validade do certificado do servidor.</span><span class="sxs-lookup"><span data-stu-id="15c3f-206">Note that these checks are done in addition to determining the validity of the server certificate.</span></span> <span data-ttu-id="15c3f-207">Por padrão, o WCF valida que o certificado do servidor é emitido por uma autoridade raiz confiável.</span><span class="sxs-lookup"><span data-stu-id="15c3f-207">By default, WCF validates that the server certificate is issued by a trusted root authority.</span></span>  
  
- <span data-ttu-id="15c3f-208">Certificado.</span><span class="sxs-lookup"><span data-stu-id="15c3f-208">Certificate.</span></span> <span data-ttu-id="15c3f-209">Durante o handshake de SSL, o WCF garante que o ponto de extremidade remoto forneça o valor de certificado exato especificado na identidade.</span><span class="sxs-lookup"><span data-stu-id="15c3f-209">During the SSL handshake, WCF ensures that the remote endpoint provides the exact certificate value specified in the identity.</span></span>  
  
- <span data-ttu-id="15c3f-210">Referência de certificado.</span><span class="sxs-lookup"><span data-stu-id="15c3f-210">Certificate Reference.</span></span> <span data-ttu-id="15c3f-211">O mesmo que o certificado.</span><span class="sxs-lookup"><span data-stu-id="15c3f-211">Same as Certificate.</span></span>  
  
- <span data-ttu-id="15c3f-212">RSA.</span><span class="sxs-lookup"><span data-stu-id="15c3f-212">RSA.</span></span> <span data-ttu-id="15c3f-213">Durante o handshake de SSL, o WCF garante que o ponto de extremidade remoto forneça a chave RSA exata especificada na identidade.</span><span class="sxs-lookup"><span data-stu-id="15c3f-213">During the SSL handshake, WCF ensures that the remote endpoint provides the exact RSA key specified in the identity.</span></span>  
  
 <span data-ttu-id="15c3f-214">Se o serviço se autenticar usando SSL de nível de transporte ou de mensagem com uma credencial do Windows para autenticação e negociar a credencial, os seguintes valores de identidade serão válidos:</span><span class="sxs-lookup"><span data-stu-id="15c3f-214">If the service authenticates using message- or transport-level SSL with a Windows credential for authentication, and negotiates the credential, the following identity values are valid:</span></span>  
  
- <span data-ttu-id="15c3f-215">DNS.</span><span class="sxs-lookup"><span data-stu-id="15c3f-215">DNS.</span></span> <span data-ttu-id="15c3f-216">A negociação passa o SPN do serviço para que o nome DNS possa ser verificado.</span><span class="sxs-lookup"><span data-stu-id="15c3f-216">The negotiation passes the service's SPN so that the DNS name can be checked.</span></span> <span data-ttu-id="15c3f-217">O SPN está no formato `host/<dns name>` .</span><span class="sxs-lookup"><span data-stu-id="15c3f-217">The SPN is in the form `host/<dns name>`.</span></span>  
  
- <span data-ttu-id="15c3f-218">SPNs.</span><span class="sxs-lookup"><span data-stu-id="15c3f-218">SPN.</span></span> <span data-ttu-id="15c3f-219">Um SPN de serviço explícito é retornado, por exemplo, `host/myservice` .</span><span class="sxs-lookup"><span data-stu-id="15c3f-219">An explicit service SPN is returned, for example, `host/myservice`.</span></span>  
  
- <span data-ttu-id="15c3f-220">Sufixo.</span><span class="sxs-lookup"><span data-stu-id="15c3f-220">UPN.</span></span> <span data-ttu-id="15c3f-221">O UPN da conta de serviço.</span><span class="sxs-lookup"><span data-stu-id="15c3f-221">The UPN of the service account.</span></span> <span data-ttu-id="15c3f-222">O UPN está no formato `username` @ `domain` .</span><span class="sxs-lookup"><span data-stu-id="15c3f-222">The UPN is in the form `username`@`domain`.</span></span> <span data-ttu-id="15c3f-223">Por exemplo, quando o serviço está sendo executado em uma conta de usuário, pode ser `username@contoso.com` .</span><span class="sxs-lookup"><span data-stu-id="15c3f-223">For example, when the service is running in a user account, it may be `username@contoso.com`.</span></span>  
  
 <span data-ttu-id="15c3f-224">Especificar a identidade programaticamente (usando a <xref:System.ServiceModel.EndpointAddress.Identity%2A> Propriedade) é opcional.</span><span class="sxs-lookup"><span data-stu-id="15c3f-224">Specifying the identity programmatically (using the <xref:System.ServiceModel.EndpointAddress.Identity%2A> property) is optional.</span></span> <span data-ttu-id="15c3f-225">Se nenhuma identidade for especificada e o tipo de credencial do cliente for Windows, o padrão será SPN com o valor definido para a parte hostname do endereço do ponto de extremidade de serviço prefixado com o literal "host/".</span><span class="sxs-lookup"><span data-stu-id="15c3f-225">If no identity is specified, and the client credential type is Windows, the default is SPN with the value set to the hostname part of the service endpoint address prefixed with the "host/" literal.</span></span> <span data-ttu-id="15c3f-226">Se nenhuma identidade for especificada e o tipo de credencial do cliente for um certificado, o padrão será `Certificate` .</span><span class="sxs-lookup"><span data-stu-id="15c3f-226">If no identity is specified, and the client credential type is a certificate, the default is `Certificate`.</span></span> <span data-ttu-id="15c3f-227">Isso se aplica à segurança em nível de transporte e de mensagem.</span><span class="sxs-lookup"><span data-stu-id="15c3f-227">This applies to both message- and transport-level security.</span></span>  
  
## <a name="identity-and-custom-bindings"></a><span data-ttu-id="15c3f-228">Identidades e associações personalizadas</span><span class="sxs-lookup"><span data-stu-id="15c3f-228">Identity and Custom Bindings</span></span>  
 <span data-ttu-id="15c3f-229">Como a identidade de um serviço depende do tipo de associação usado, verifique se uma identidade apropriada é exposta ao criar uma associação personalizada.</span><span class="sxs-lookup"><span data-stu-id="15c3f-229">Because the identity of a service depends on the binding type used, ensure that an appropriate identity is exposed when creating a custom binding.</span></span> <span data-ttu-id="15c3f-230">Por exemplo, no exemplo de código a seguir, a identidade exposta não é compatível com o tipo de segurança, porque a identidade para a associação de inicialização de conversa segura não corresponde à identidade da associação no ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="15c3f-230">For example, in the following code example, the identity exposed is not compatible with the security type, because the identity for the secure conversation bootstrap binding does not match the identity for the binding on the endpoint.</span></span> <span data-ttu-id="15c3f-231">A associação de conversa segura define a identidade DNS, enquanto o <xref:System.ServiceModel.Channels.WindowsStreamSecurityBindingElement> define a identidade UPN ou SPN.</span><span class="sxs-lookup"><span data-stu-id="15c3f-231">The secure conversation binding sets the DNS identity, while the <xref:System.ServiceModel.Channels.WindowsStreamSecurityBindingElement> sets the UPN or SPN identity.</span></span>  
  
 [!code-csharp[C_Identity#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#8)]
 [!code-vb[C_Identity#8](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#8)]  
  
 <span data-ttu-id="15c3f-232">Para obter mais informações sobre como empilhar os elementos de associação corretamente para uma associação personalizada, consulte [Criando associações definidas pelo usuário](../extending/creating-user-defined-bindings.md).</span><span class="sxs-lookup"><span data-stu-id="15c3f-232">For more information about how to stack binding elements correctly for a custom binding, see [Creating User-Defined Bindings](../extending/creating-user-defined-bindings.md).</span></span> <span data-ttu-id="15c3f-233">Para obter mais informações sobre como criar uma associação personalizada com o <xref:System.ServiceModel.Channels.SecurityBindingElement> , consulte [como: criar um SecurityBindingElement para um modo de autenticação especificado](how-to-create-a-securitybindingelement-for-a-specified-authentication-mode.md).</span><span class="sxs-lookup"><span data-stu-id="15c3f-233">For more information about creating a custom binding with the <xref:System.ServiceModel.Channels.SecurityBindingElement>, see [How to: Create a SecurityBindingElement for a Specified Authentication Mode](how-to-create-a-securitybindingelement-for-a-specified-authentication-mode.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="15c3f-234">Veja também</span><span class="sxs-lookup"><span data-stu-id="15c3f-234">See also</span></span>

- [<span data-ttu-id="15c3f-235">Como criar uma associação personalizada utilizando o SecurityBindingElement</span><span class="sxs-lookup"><span data-stu-id="15c3f-235">How to: Create a Custom Binding Using the SecurityBindingElement</span></span>](how-to-create-a-custom-binding-using-the-securitybindingelement.md)
- [<span data-ttu-id="15c3f-236">Como criar um SecurityBindingElement para um modo de autenticação especificado</span><span class="sxs-lookup"><span data-stu-id="15c3f-236">How to: Create a SecurityBindingElement for a Specified Authentication Mode</span></span>](how-to-create-a-securitybindingelement-for-a-specified-authentication-mode.md)
- [<span data-ttu-id="15c3f-237">Como criar um verificador de identidade de cliente personalizado</span><span class="sxs-lookup"><span data-stu-id="15c3f-237">How to: Create a Custom Client Identity Verifier</span></span>](../extending/how-to-create-a-custom-client-identity-verifier.md)
- [<span data-ttu-id="15c3f-238">Selecionando um tipo de credencial</span><span class="sxs-lookup"><span data-stu-id="15c3f-238">Selecting a Credential Type</span></span>](selecting-a-credential-type.md)
- [<span data-ttu-id="15c3f-239">Trabalhando com certificados</span><span class="sxs-lookup"><span data-stu-id="15c3f-239">Working with Certificates</span></span>](working-with-certificates.md)
- [<span data-ttu-id="15c3f-240">Ferramenta de utilitário de metadados ServiceModel (Svcutil.exe)</span><span class="sxs-lookup"><span data-stu-id="15c3f-240">ServiceModel Metadata Utility Tool (Svcutil.exe)</span></span>](../servicemodel-metadata-utility-tool-svcutil-exe.md)
- [<span data-ttu-id="15c3f-241">Criando associações definidas pelo usuário</span><span class="sxs-lookup"><span data-stu-id="15c3f-241">Creating User-Defined Bindings</span></span>](../extending/creating-user-defined-bindings.md)
- [<span data-ttu-id="15c3f-242">Como recuperar a impressão digital de um certificado</span><span class="sxs-lookup"><span data-stu-id="15c3f-242">How to: Retrieve the Thumbprint of a Certificate</span></span>](how-to-retrieve-the-thumbprint-of-a-certificate.md)
