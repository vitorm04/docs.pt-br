---
title: Apêndice-gRPC para desenvolvedores do WCF
description: Discussão sobre transações distribuídas e sua implementação em arquiteturas de microserviços modernas.
ms.date: 09/02/2019
ms.openlocfilehash: 9931681727f921e007c2f80852ad0e69cd7288de
ms.sourcegitcommit: 5fb5b6520b06d7f5e6131ec2ad854da302a28f2e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/03/2019
ms.locfileid: "74711465"
---
# <a name="appendix-a---transactions"></a><span data-ttu-id="fb92a-103">Apêndice A – transações</span><span class="sxs-lookup"><span data-stu-id="fb92a-103">Appendix A - Transactions</span></span>

<span data-ttu-id="fb92a-104">O Windows Communication Foundation (WCF) dá suporte a transações distribuídas, permitindo que você execute operações atômicas em vários serviços.</span><span class="sxs-lookup"><span data-stu-id="fb92a-104">Windows Communication Foundation (WCF) supports distributed transactions, allowing you to perform atomic operations across multiple services.</span></span> <span data-ttu-id="fb92a-105">Essa funcionalidade é baseada no [Microsoft coordenador de transações distribuídas](https://docs.microsoft.com/previous-versions/windows/desktop/ms684146(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="fb92a-105">This functionality is based on the [Microsoft Distributed Transaction Coordinator](https://docs.microsoft.com/previous-versions/windows/desktop/ms684146(v=vs.85)).</span></span>

<span data-ttu-id="fb92a-106">Na nova paisagem de microserviços, esse tipo de processamento automatizado de transações distribuídas não é possível.</span><span class="sxs-lookup"><span data-stu-id="fb92a-106">In the newer microservices landscape, this type of automated distributed transaction processing isn't possible.</span></span> <span data-ttu-id="fb92a-107">Há muitas tecnologias diferentes envolvidas, incluindo bancos de dados relacionais, armazenamentos de dado NoSQL e sistemas de mensagens.</span><span class="sxs-lookup"><span data-stu-id="fb92a-107">There are too many different technologies involved, including relational databases, NoSQL data stores, and messaging systems.</span></span> <span data-ttu-id="fb92a-108">Também pode haver uma combinação de sistemas operacionais, linguagens de programação e estruturas em uso em um único ambiente.</span><span class="sxs-lookup"><span data-stu-id="fb92a-108">There might also be a mix of operating systems, programming languages, and frameworks in use in a single environment.</span></span>

<span data-ttu-id="fb92a-109">A transação distribuída do WCF é uma implementação do que é conhecido como uma [confirmação de duas fases (2PC)](https://en.wikipedia.org/wiki/Two-phase_commit_protocol).</span><span class="sxs-lookup"><span data-stu-id="fb92a-109">WCF distributed transaction is an implementation of what is known as a [two-phase commit (2PC)](https://en.wikipedia.org/wiki/Two-phase_commit_protocol).</span></span> <span data-ttu-id="fb92a-110">Você pode implementar transações 2PC manualmente coordenando mensagens entre serviços, criando transações abertas dentro de cada serviço e enviando mensagens de confirmação ou reversão, dependendo do êxito ou da falha.</span><span class="sxs-lookup"><span data-stu-id="fb92a-110">You can implement 2PC transactions manually by coordinating messages across services, creating open transactions within each service, and sending commit or rollback messages, depending upon success or failure.</span></span> <span data-ttu-id="fb92a-111">No entanto, a complexidade envolvida no gerenciamento de 2PC pode aumentar exponencialmente conforme os sistemas evoluem.</span><span class="sxs-lookup"><span data-stu-id="fb92a-111">However, the complexity involved in managing 2PC can increase exponentially as systems evolve.</span></span> <span data-ttu-id="fb92a-112">Transações abertas mantêm bloqueios de banco de dados que podem afetar negativamente o desempenho ou, pior, causam deadlocks entre serviços.</span><span class="sxs-lookup"><span data-stu-id="fb92a-112">Open transactions hold database locks that can negatively affect performance, or, worse, cause cross-service deadlocks.</span></span>

<span data-ttu-id="fb92a-113">Se possível, é melhor evitar totalmente as transações distribuídas.</span><span class="sxs-lookup"><span data-stu-id="fb92a-113">If possible, it's best to avoid distributed transactions altogether.</span></span> <span data-ttu-id="fb92a-114">Se dois itens de dados estiverem tão vinculados quanto exigirem atualizações atômicas, considere tratá-los com o mesmo serviço.</span><span class="sxs-lookup"><span data-stu-id="fb92a-114">If two items of data are so linked as to require atomic updates, consider handling them both with the same service.</span></span> <span data-ttu-id="fb92a-115">Aplique essas alterações atômicas usando uma única solicitação ou mensagem para esse serviço.</span><span class="sxs-lookup"><span data-stu-id="fb92a-115">Apply those atomic changes by using a single request or message to that service.</span></span>

<span data-ttu-id="fb92a-116">Se isso não for possível, então uma alternativa é usar o [padrão saga](https://microservices.io/patterns/data/saga.html).</span><span class="sxs-lookup"><span data-stu-id="fb92a-116">If that isn't possible, then one alternative is to use the [Saga pattern](https://microservices.io/patterns/data/saga.html).</span></span> <span data-ttu-id="fb92a-117">Em um saga, as atualizações são processadas sequencialmente; à medida que cada atualização é realizada com sucesso, a próxima é disparada.</span><span class="sxs-lookup"><span data-stu-id="fb92a-117">In a saga, updates are processed sequentially; as each update succeeds, the next one is triggered.</span></span> <span data-ttu-id="fb92a-118">Esses gatilhos podem ser propagados do serviço para o serviço ou gerenciados por um coordenador ou orquestrador do Saga.</span><span class="sxs-lookup"><span data-stu-id="fb92a-118">These triggers can be propagated from service to service, or managed by a saga coordinator or orchestrator.</span></span> <span data-ttu-id="fb92a-119">Se uma atualização falhar em qualquer ponto durante o processo, os serviços que já concluíram suas atualizações aplicarão uma lógica específica para invertê-las.</span><span class="sxs-lookup"><span data-stu-id="fb92a-119">If an update fails at any point during the process, the services that have already completed their updates apply specific logic to reverse them.</span></span>

<span data-ttu-id="fb92a-120">Outra opção é usar o DDD (design controlado por domínio) e o CQRS (segregação de responsabilidade de comando/consulta), conforme descrito no [livro eletrônico de microservices do .net](https://docs.microsoft.com/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/).</span><span class="sxs-lookup"><span data-stu-id="fb92a-120">Another option is to use Domain Driven Design (DDD) and Command/Query Responsibility Segregation (CQRS), as described in the [.NET Microservices e-book](https://docs.microsoft.com/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/).</span></span> <span data-ttu-id="fb92a-121">Em particular, o uso de eventos de domínio ou [fornecimento de eventos](https://martinfowler.com/eaaDev/EventSourcing.html) pode ajudar a garantir que as atualizações sejam consistentemente, caso não sejam aplicadas imediatamente.</span><span class="sxs-lookup"><span data-stu-id="fb92a-121">In particular, using domain events or [event sourcing](https://martinfowler.com/eaaDev/EventSourcing.html) can help to ensure that updates are consistently, if not immediately, applied.</span></span>

>[!div class="step-by-step"]
>[<span data-ttu-id="fb92a-122">Anterior</span><span class="sxs-lookup"><span data-stu-id="fb92a-122">Previous</span></span>](application-performance-management.md)
