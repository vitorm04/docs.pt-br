---
title: "Armazenamento local de thread: campos estáticos relativos a thread e slots de dados"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-standard
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- threading [.NET Framework], local storage
- threading [.NET Framework], thread-relative static fields
- local thread storage
- TLS
ms.assetid: c633a4dc-a790-4ed1-96b5-f72bd968b284
caps.latest.revision: "13"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.openlocfilehash: 39dd80d378171563f2aadadaa146278e8a417d32
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/21/2017
---
# <a name="thread-local-storage-thread-relative-static-fields-and-data-slots"></a><span data-ttu-id="3249b-102">Armazenamento local de thread: campos estáticos relativos a thread e slots de dados</span><span class="sxs-lookup"><span data-stu-id="3249b-102">Thread Local Storage: Thread-Relative Static Fields and Data Slots</span></span>
<span data-ttu-id="3249b-103">Você pode usar gerenciado armazenamento local de thread (TLS) para armazenar dados que seja exclusivo em um domínio de aplicativo e thread.</span><span class="sxs-lookup"><span data-stu-id="3249b-103">You can use managed thread local storage (TLS) to store data that is unique to a thread and application domain.</span></span> <span data-ttu-id="3249b-104">O .NET Framework fornece duas maneiras de usar gerenciado TLS: slots dados e campos estáticos relativos a thread.</span><span class="sxs-lookup"><span data-stu-id="3249b-104">The .NET Framework provides two ways to use managed TLS: thread-relative static fields and data slots.</span></span>  
  
-   <span data-ttu-id="3249b-105">Use campos estáticos relativos a thread (relativos a thread `Shared` campos no Visual Basic) se você puder prever suas necessidades exatas em tempo de compilação.</span><span class="sxs-lookup"><span data-stu-id="3249b-105">Use thread-relative static fields (thread-relative `Shared` fields in Visual Basic) if you can anticipate your exact needs at compile time.</span></span> <span data-ttu-id="3249b-106">Campos estáticos relativos a thread fornecem o melhor desempenho.</span><span class="sxs-lookup"><span data-stu-id="3249b-106">Thread-relative static fields provide the best performance.</span></span> <span data-ttu-id="3249b-107">Eles também oferecem os benefícios de verificação de tipo de tempo de compilação.</span><span class="sxs-lookup"><span data-stu-id="3249b-107">They also give you the benefits of compile-time type checking.</span></span>  
  
-   <span data-ttu-id="3249b-108">Use os slots de dados quando os requisitos reais podem ser descobertos somente em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="3249b-108">Use data slots when your actual requirements might be discovered only at run time.</span></span> <span data-ttu-id="3249b-109">Slots de dados são mais lento e mais inadequado para uso de campos estáticos relativos a thread e dados são armazenados como tipo <xref:System.Object>, portanto, você deve convertê-lo para o tipo correto antes de você usá-lo.</span><span class="sxs-lookup"><span data-stu-id="3249b-109">Data slots are slower and more awkward to use than thread-relative static fields, and data is stored as type <xref:System.Object>, so you must cast it to the correct type before you use it.</span></span>  
  
 <span data-ttu-id="3249b-110">Em C++ não gerenciado, você deve usar `TlsAlloc` alocar slots dinamicamente e `__declspec(thread)` para declarar que uma variável deve ser alocada no armazenamento relativos a thread.</span><span class="sxs-lookup"><span data-stu-id="3249b-110">In unmanaged C++, you use `TlsAlloc` to allocate slots dynamically and `__declspec(thread)` to declare that a variable should be allocated in thread-relative storage.</span></span> <span data-ttu-id="3249b-111">Slots dados e campos estáticos relativos a thread fornecem a versão gerenciada desse comportamento.</span><span class="sxs-lookup"><span data-stu-id="3249b-111">Thread-relative static fields and data slots provide the managed version of this behavior.</span></span>  
  
 <span data-ttu-id="3249b-112">No [!INCLUDE[net_v40_long](../../../includes/net-v40-long-md.md)], você pode usar o <xref:System.Threading.ThreadLocal%601?displayProperty=nameWithType> classe para criar objetos de local de thread que são inicializados lentamente quando o objeto é consumido pela primeira vez.</span><span class="sxs-lookup"><span data-stu-id="3249b-112">In the [!INCLUDE[net_v40_long](../../../includes/net-v40-long-md.md)], you can use the <xref:System.Threading.ThreadLocal%601?displayProperty=nameWithType> class to create thread-local objects that are initialized lazily when the object is first consumed.</span></span> <span data-ttu-id="3249b-113">Para obter mais informações, veja [Inicialização lenta](../../../docs/framework/performance/lazy-initialization.md).</span><span class="sxs-lookup"><span data-stu-id="3249b-113">For more information, see [Lazy Initialization](../../../docs/framework/performance/lazy-initialization.md).</span></span>  
  
## <a name="uniqueness-of-data-in-managed-tls"></a><span data-ttu-id="3249b-114">Exclusividade dos dados no TLS gerenciado</span><span class="sxs-lookup"><span data-stu-id="3249b-114">Uniqueness of Data in Managed TLS</span></span>  
 <span data-ttu-id="3249b-115">Se você usar campos estáticos relativos a thread ou slots de dados, dados no TLS gerenciado são exclusivos para a combinação de domínio de aplicativo e o thread.</span><span class="sxs-lookup"><span data-stu-id="3249b-115">Whether you use thread-relative static fields or data slots, data in managed TLS is unique to the combination of thread and application domain.</span></span>  
  
-   <span data-ttu-id="3249b-116">Dentro de um domínio de aplicativo, um thread não é possível modificar os dados de outro thread, mesmo quando ambos os threads usam o mesmo campo ou um slot.</span><span class="sxs-lookup"><span data-stu-id="3249b-116">Within an application domain, one thread cannot modify data from another thread, even when both threads use the same field or slot.</span></span>  
  
-   <span data-ttu-id="3249b-117">Quando um thread acessa o mesmo campo ou o slot de vários domínios de aplicativo, um valor separado é mantido em cada domínio de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="3249b-117">When a thread accesses the same field or slot from multiple application domains, a separate value is maintained in each application domain.</span></span>  
  
 <span data-ttu-id="3249b-118">Por exemplo, se um thread define o valor de um campo estático relativos a thread, entra em outro domínio de aplicativo e, em seguida, recupera o valor do campo, o valor recuperado no segundo domínio de aplicativo é diferente do valor no primeiro domínio de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="3249b-118">For example, if a thread sets the value of a thread-relative static field, enters another application domain, and then retrieves the value of the field, the value retrieved in the second application domain differs from the value in the first application domain.</span></span> <span data-ttu-id="3249b-119">Definindo um novo valor para o campo no segundo domínio de aplicativo não afeta o valor do campo no primeiro domínio de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="3249b-119">Setting a new value for the field in the second application domain does not affect the field's value in the first application domain.</span></span>  
  
 <span data-ttu-id="3249b-120">Da mesma forma, quando um thread é o mesmo slot de dados nomeado em dois domínios diferentes, os dados no primeiro domínio de aplicativo permanecem independentemente dos dados no segundo domínio de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="3249b-120">Similarly, when a thread gets the same named data slot in two different application domains, the data in the first application domain remains independent of the data in the second application domain.</span></span>  
  
## <a name="thread-relative-static-fields"></a><span data-ttu-id="3249b-121">Campos estáticos relativos a thread</span><span class="sxs-lookup"><span data-stu-id="3249b-121">Thread-Relative Static Fields</span></span>  
 <span data-ttu-id="3249b-122">Se você souber que uma parte dos dados sempre é exclusiva para uma combinação de domínio de aplicativo e um thread, aplique a <xref:System.ThreadStaticAttribute> de atributo para o campo estático.</span><span class="sxs-lookup"><span data-stu-id="3249b-122">If you know that a piece of data is always unique to a thread and application-domain combination, apply the <xref:System.ThreadStaticAttribute> attribute to the static field.</span></span> <span data-ttu-id="3249b-123">Use o campo que você usaria qualquer outro campo estático.</span><span class="sxs-lookup"><span data-stu-id="3249b-123">Use the field as you would use any other static field.</span></span> <span data-ttu-id="3249b-124">Os dados no campo são exclusivos para cada thread que utiliza.</span><span class="sxs-lookup"><span data-stu-id="3249b-124">The data in the field is unique to each thread that uses it.</span></span>  
  
 <span data-ttu-id="3249b-125">Campos estáticos relativos a thread fornecem desempenho melhor que slots de dados e tem a vantagem de verificação de tipo de tempo de compilação.</span><span class="sxs-lookup"><span data-stu-id="3249b-125">Thread-relative static fields provide better performance than data slots and have the benefit of compile-time type checking.</span></span>  
  
 <span data-ttu-id="3249b-126">Lembre-se de que qualquer código de construtor da classe será executado no primeiro segmento no contexto primeiro que acessa o campo.</span><span class="sxs-lookup"><span data-stu-id="3249b-126">Be aware that any class constructor code will run on the first thread in the first context that accesses the field.</span></span> <span data-ttu-id="3249b-127">Em todos os outros segmentos ou contextos no mesmo domínio de aplicativo, os campos serão inicializados com `null` (`Nothing` no Visual Basic) se eles são tipos de referência ou para seu padrão valores se eles são os tipos de valor.</span><span class="sxs-lookup"><span data-stu-id="3249b-127">In all other threads or contexts in the same application domain, the fields will be initialized to `null` (`Nothing` in Visual Basic) if they are reference types, or to their default values if they are value types.</span></span> <span data-ttu-id="3249b-128">Portanto, você não deve confiar em construtores de classe para inicializar campos estáticos relativos a thread.</span><span class="sxs-lookup"><span data-stu-id="3249b-128">Therefore, you should not rely on class constructors to initialize thread-relative static fields.</span></span> <span data-ttu-id="3249b-129">Em vez disso, evite inicializar campos estáticos relativos a thread e suponha que eles sejam inicializados para `null` (`Nothing`) ou para seus valores padrão.</span><span class="sxs-lookup"><span data-stu-id="3249b-129">Instead, avoid initializing thread-relative static fields and assume that they are initialized to `null` (`Nothing`) or to their default values.</span></span>  
  
## <a name="data-slots"></a><span data-ttu-id="3249b-130">Slots de dados</span><span class="sxs-lookup"><span data-stu-id="3249b-130">Data Slots</span></span>  
 <span data-ttu-id="3249b-131">O .NET Framework fornece slots de dados dinâmicos que são exclusivos a uma combinação de thread e o domínio de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="3249b-131">The .NET Framework provides dynamic data slots that are unique to a combination of thread and application-domain.</span></span> <span data-ttu-id="3249b-132">Há dois tipos de slots de dados: chamada de slots e slots sem nome.</span><span class="sxs-lookup"><span data-stu-id="3249b-132">There are two types of data slots: named slots and unnamed slots.</span></span> <span data-ttu-id="3249b-133">Ambos são implementados usando o <xref:System.LocalDataStoreSlot> estrutura.</span><span class="sxs-lookup"><span data-stu-id="3249b-133">Both are implemented by using the <xref:System.LocalDataStoreSlot> structure.</span></span>  
  
-   <span data-ttu-id="3249b-134">Para criar um slot de dados nomeado, use o <xref:System.Threading.Thread.AllocateNamedDataSlot%2A?displayProperty=nameWithType> ou <xref:System.Threading.Thread.GetNamedDataSlot%2A?displayProperty=nameWithType> método.</span><span class="sxs-lookup"><span data-stu-id="3249b-134">To create a named data slot, use the <xref:System.Threading.Thread.AllocateNamedDataSlot%2A?displayProperty=nameWithType> or <xref:System.Threading.Thread.GetNamedDataSlot%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="3249b-135">Para obter uma referência a um arquivo denominado slot, passe seu nome para o <xref:System.Threading.Thread.GetNamedDataSlot%2A> método.</span><span class="sxs-lookup"><span data-stu-id="3249b-135">To get a reference to an existing named slot, pass its name to the <xref:System.Threading.Thread.GetNamedDataSlot%2A> method.</span></span>  
  
-   <span data-ttu-id="3249b-136">Para criar um slot de dados sem nome, use o <xref:System.Threading.Thread.AllocateDataSlot%2A?displayProperty=nameWithType> método.</span><span class="sxs-lookup"><span data-stu-id="3249b-136">To create an unnamed data slot, use the <xref:System.Threading.Thread.AllocateDataSlot%2A?displayProperty=nameWithType> method.</span></span>  
  
 <span data-ttu-id="3249b-137">Para ambos nome e sem nome slots, use o <xref:System.Threading.Thread.SetData%2A?displayProperty=nameWithType> e <xref:System.Threading.Thread.GetData%2A?displayProperty=nameWithType> métodos para definir e recuperar as informações no slot.</span><span class="sxs-lookup"><span data-stu-id="3249b-137">For both named and unnamed slots, use the <xref:System.Threading.Thread.SetData%2A?displayProperty=nameWithType> and <xref:System.Threading.Thread.GetData%2A?displayProperty=nameWithType> methods to set and retrieve the information in the slot.</span></span> <span data-ttu-id="3249b-138">Esses são os métodos estáticos que sempre atuam sobre os dados para o thread que está em execução-los.</span><span class="sxs-lookup"><span data-stu-id="3249b-138">These are static methods that always act on the data for the thread that is currently executing them.</span></span>  
  
 <span data-ttu-id="3249b-139">Slots nomeados podem ser convenientes, porque você pode recuperar o slot quando necessário, passando o nome para o <xref:System.Threading.Thread.GetNamedDataSlot%2A> método, em vez de manter uma referência para um slot sem nome.</span><span class="sxs-lookup"><span data-stu-id="3249b-139">Named slots can be convenient, because you can retrieve the slot when you need it by passing its name to the <xref:System.Threading.Thread.GetNamedDataSlot%2A> method, instead of maintaining a reference to an unnamed slot.</span></span> <span data-ttu-id="3249b-140">No entanto, se outro componente usa o mesmo nome para seu armazenamento relativos a thread e um thread executa código do seu componente e o outro componente, os dois componentes podem corromper os dados do outro.</span><span class="sxs-lookup"><span data-stu-id="3249b-140">However, if another component uses the same name for its thread-relative storage and a thread executes code from both your component and the other component, the two components might corrupt each other's data.</span></span> <span data-ttu-id="3249b-141">(Este cenário pressupõe que ambos os componentes estão em execução no mesmo domínio do aplicativo e que eles não são projetados para compartilhar os mesmos dados.)</span><span class="sxs-lookup"><span data-stu-id="3249b-141">(This scenario assumes that both components are running in the same application domain, and that they are not designed to share the same data.)</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="3249b-142">Consulte também</span><span class="sxs-lookup"><span data-stu-id="3249b-142">See Also</span></span>  
 <xref:System.ContextStaticAttribute>  
 <xref:System.Threading.Thread.GetNamedDataSlot%2A?displayProperty=nameWithType>  
 <xref:System.ThreadStaticAttribute>  
 <xref:System.Runtime.Remoting.Messaging.CallContext>  
 [<span data-ttu-id="3249b-143">Threading</span><span class="sxs-lookup"><span data-stu-id="3249b-143">Threading</span></span>](../../../docs/standard/threading/index.md)
