---
title: Criando, evoluindo e fazendo o controle de versão de APIs e de contratos de microsserviços
description: Crie contratos e APIs de microsserviço levando em conta a evolução e o controle de versão, porque a alteração é necessária.
ms.date: 09/20/2018
ms.openlocfilehash: 1972d02d8bf7935c71bfd383707ae19ea2baded9
ms.sourcegitcommit: 8699383914c24a0df033393f55db3369db728a7b
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/15/2019
ms.locfileid: "65644922"
---
# <a name="creating-evolving-and-versioning-microservice-apis-and-contracts"></a><span data-ttu-id="9b068-103">Criando, evoluindo e fazendo o controle de versão de APIs e de contratos de microsserviços</span><span class="sxs-lookup"><span data-stu-id="9b068-103">Creating, evolving, and versioning microservice APIs and contracts</span></span>

<span data-ttu-id="9b068-104">Uma API de microsserviço é um contrato entre o serviço e seus clientes.</span><span class="sxs-lookup"><span data-stu-id="9b068-104">A microservice API is a contract between the service and its clients.</span></span> <span data-ttu-id="9b068-105">Você poderá evoluir um microsserviço de forma independente apenas se você não precisar interromper seu contrato de API, que é o motivo pelo qual o contrato é tão importante.</span><span class="sxs-lookup"><span data-stu-id="9b068-105">You'll be able to evolve a microservice independently only if you do not break its API contract, which is why the contract is so important.</span></span> <span data-ttu-id="9b068-106">Se você alterar o contrato, isso afetará seus aplicativos cliente ou seu Gateway de API.</span><span class="sxs-lookup"><span data-stu-id="9b068-106">If you change the contract, it will impact your client applications or your API Gateway.</span></span>

<span data-ttu-id="9b068-107">A natureza da definição de API depende do protocolo que você está usando.</span><span class="sxs-lookup"><span data-stu-id="9b068-107">The nature of the API definition depends on which protocol you're using.</span></span> <span data-ttu-id="9b068-108">Por exemplo, se você estiver usando mensagens (como [AMQP](https://www.amqp.org/)), a API consistirá nos tipos de mensagem.</span><span class="sxs-lookup"><span data-stu-id="9b068-108">For instance, if you're using messaging (like [AMQP](https://www.amqp.org/)), the API consists of the message types.</span></span> <span data-ttu-id="9b068-109">Se você estiver usando serviços HTTP e RESTful, a API consistirá nas URLs e nos formatos JSON de solicitação e de resposta.</span><span class="sxs-lookup"><span data-stu-id="9b068-109">If you're using HTTP and RESTful services, the API consists of the URLs and the request and response JSON formats.</span></span>

<span data-ttu-id="9b068-110">No entanto, mesmo se você estiver em dúvida sobre seu contrato inicial, uma API de serviço precisará ser alterada com o tempo.</span><span class="sxs-lookup"><span data-stu-id="9b068-110">However, even if you're thoughtful about your initial contract, a service API will need to change over time.</span></span> <span data-ttu-id="9b068-111">Quando isso acontecer – e, principalmente, se a API for uma API pública consumida por vários aplicativos cliente – normalmente não será possível forçar todos os clientes a atualizarem para seu novo contrato de API.</span><span class="sxs-lookup"><span data-stu-id="9b068-111">When that happens—and especially if your API is a public API consumed by multiple client applications — you typically can't force all clients to upgrade to your new API contract.</span></span> <span data-ttu-id="9b068-112">Geralmente, é necessário implantar novas versões de um serviço de forma incremental de maneira que versões novas e antigas de um contrato de serviço estejam em execução simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="9b068-112">You usually need to incrementally deploy new versions of a service in a way that both old and new versions of a service contract are running simultaneously.</span></span> <span data-ttu-id="9b068-113">Portanto, é importante ter uma estratégia para o controle de versão do serviço.</span><span class="sxs-lookup"><span data-stu-id="9b068-113">Therefore, it's important to have a strategy for your service versioning.</span></span>

<span data-ttu-id="9b068-114">Quando as alterações na API forem pequenas, como adicionar atributos ou parâmetros à sua API, os clientes que usam uma API mais antiga devem mudar e trabalhar com a nova versão do serviço.</span><span class="sxs-lookup"><span data-stu-id="9b068-114">When the API changes are small, like if you add attributes or parameters to your API, clients that use an older API should switch and work with the new version of the service.</span></span> <span data-ttu-id="9b068-115">Talvez seja possível fornecer valores padrão para quaisquer atributos ausentes que sejam necessários, e os clientes talvez podem ignorar quaisquer atributos de resposta extra.</span><span class="sxs-lookup"><span data-stu-id="9b068-115">You might be able to provide default values for any missing attributes that are required, and the clients might be able to ignore any extra response attributes.</span></span>

<span data-ttu-id="9b068-116">No entanto, às vezes, é necessário fazer alterações importantes e incompatíveis em uma API de serviço.</span><span class="sxs-lookup"><span data-stu-id="9b068-116">However, sometimes you need to make major and incompatible changes to a service API.</span></span> <span data-ttu-id="9b068-117">Como talvez não seja possível forçar serviços ou aplicativos cliente a serem atualizados imediatamente para a nova versão, um serviço deve dar suporte a versões mais antigas da API por algum período.</span><span class="sxs-lookup"><span data-stu-id="9b068-117">Because you might not be able to force client applications or services to upgrade immediately to the new version, a service must support older versions of the API for some period.</span></span> <span data-ttu-id="9b068-118">Se você estiver usando um mecanismo baseado em HTTP como REST, uma abordagem deverá inserir o número de versão da API na URL ou no cabeçalho HTTP.</span><span class="sxs-lookup"><span data-stu-id="9b068-118">If you're using an HTTP-based mechanism such as REST, one approach is to embed the API version number in the URL or into an HTTP header.</span></span> <span data-ttu-id="9b068-119">Em seguida, é possível decidir entre implementar ambas as versões do serviço simultaneamente dentro da mesma instância de serviço ou implantar instâncias diferentes que lidam com uma versão da API.</span><span class="sxs-lookup"><span data-stu-id="9b068-119">Then you can decide between implementing both versions of the service simultaneously within the same service instance, or deploying different instances that each handle a version of the API.</span></span> <span data-ttu-id="9b068-120">Uma boa abordagem para isso é o [padrão mediador](https://en.wikipedia.org/wiki/Mediator_pattern) (por exemplo, [biblioteca MediatR](https://github.com/jbogard/MediatR)) para desacoplar as diferentes versões de implementação em manipuladores independentes.</span><span class="sxs-lookup"><span data-stu-id="9b068-120">A good approach for this is the [Mediator pattern](https://en.wikipedia.org/wiki/Mediator_pattern) (for example, [MediatR library](https://github.com/jbogard/MediatR)) to decouple the different implementation versions into independent handlers.</span></span>

<span data-ttu-id="9b068-121">Por fim, se você estiver usando uma arquitetura REST, o [Hypermedia](https://www.infoq.com/articles/mark-baker-hypermedia) será a melhor solução para controlar a versão de seus serviços e permitir APIs capazes de evoluir.</span><span class="sxs-lookup"><span data-stu-id="9b068-121">Finally, if you're using a REST architecture, [Hypermedia](https://www.infoq.com/articles/mark-baker-hypermedia) is the best solution for versioning your services and allowing evolvable APIs.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="9b068-122">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="9b068-122">Additional resources</span></span>

- <span data-ttu-id="9b068-123">**Scott Hanselman. Facilitando o controle de versão da API Web RESTful do ASP.NET Core** \\</span><span class="sxs-lookup"><span data-stu-id="9b068-123">**Scott Hanselman. ASP.NET Core RESTful Web API versioning made easy** \\</span></span>
  <https://www.hanselman.com/blog/ASPNETCoreRESTfulWebAPIVersioningMadeEasy.aspx>

- <span data-ttu-id="9b068-124">**Controle de versão de uma API Web RESTful** \\</span><span class="sxs-lookup"><span data-stu-id="9b068-124">**Versioning a RESTful web API** \\</span></span>
  <https://docs.microsoft.com/azure/architecture/best-practices/api-design#versioning-a-restful-web-api>

- <span data-ttu-id="9b068-125">**Roy Fielding. Controle de versão, hipermídia e REST** \\</span><span class="sxs-lookup"><span data-stu-id="9b068-125">**Roy Fielding. Versioning, Hypermedia, and REST** \\</span></span>
  <https://www.infoq.com/articles/roy-fielding-on-versioning>

>[!div class="step-by-step"]
><span data-ttu-id="9b068-126">[Anterior](asynchronous-message-based-communication.md)
>[Próximo](microservices-addressability-service-registry.md)</span><span class="sxs-lookup"><span data-stu-id="9b068-126">[Previous](asynchronous-message-based-communication.md)
[Next](microservices-addressability-service-registry.md)</span></span>
